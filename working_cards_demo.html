<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Working Dynamic Player Cards Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .player-card {
            transition: all 0.3s ease;
        }
        .player-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .autocomplete-dropdown {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .autocomplete-item {
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .autocomplete-item:hover {
            background-color: #f3f4f6;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-center mb-8">🎴 Working Dynamic Player Cards</h1>
        
        <!-- Search Section -->
        <div class="bg-white p-6 rounded-lg shadow-lg mb-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <!-- Player Search with Autocomplete -->
                <div class="relative">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Search Player</label>
                    <input type="text" id="playerSearch" 
                           placeholder="Type 'Kohl' or 'Virat'..." 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           autocomplete="off">
                    <div id="autocompleteResults" class="absolute z-10 w-full bg-white border border-gray-300 rounded-lg mt-1 hidden autocomplete-dropdown"></div>
                </div>
                
                <!-- Persona Selection -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Persona</label>
                    <select id="personaSelect" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        <option value="betting">🎰 Betting SME</option>
                        <option value="commentary">📺 TV Pundit</option>
                        <option value="coaching">🎯 Coaching Staff</option>
                        <option value="fantasy">⚡ Fantasy Team</option>
                    </select>
                </div>
                
                <!-- Generate Button -->
                <div class="flex items-end">
                    <button id="generateCard" 
                            class="w-full px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium">
                        🎴 Generate Card
                    </button>
                </div>
            </div>
            
            <!-- Popular Players -->
            <div class="mt-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Quick Select</label>
                <div class="flex flex-wrap gap-2">
                    <button class="popular-player px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-gray-200 transition-colors" data-player="Virat Kohli">Virat Kohli</button>
                    <button class="popular-player px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-gray-200 transition-colors" data-player="MS Dhoni">MS Dhoni</button>
                    <button class="popular-player px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-gray-200 transition-colors" data-player="Rohit Sharma">Rohit Sharma</button>
                    <button class="popular-player px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-gray-200 transition-colors" data-player="KL Rahul">KL Rahul</button>
                    <button class="popular-player px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-gray-200 transition-colors" data-player="Hardik Pandya">Hardik Pandya</button>
                </div>
            </div>
        </div>
        
        <!-- Generated Cards Display -->
        <div id="cardsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Cards will be inserted here -->
        </div>
        
        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white p-6 rounded-lg">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div>
                <p class="mt-2 text-gray-600">Generating dynamic card...</p>
            </div>
        </div>
    </div>

    <script>
        // Mock player database (subset from the real 17K players)
        const mockPlayers = [
            'Virat Kohli', 'MS Dhoni', 'Rohit Sharma', 'KL Rahul', 'Hardik Pandya',
            'A Kohli', 'Nikhil Kohli', 'Parth Kohli', 'Virandeep Singh', 'Virat Singh',
            'Virendra Kumar', 'Virk Ali', 'Suryakumar Yadav', 'Rishabh Pant', 
            'Jasprit Bumrah', 'AB de Villiers', 'David Warner', 'Steve Smith'
        ];
        
        let autocompleteTimeout = null;
        
        // Initialize the system
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
        });
        
        function setupEventListeners() {
            const playerSearch = document.getElementById('playerSearch');
            const generateBtn = document.getElementById('generateCard');
            const popularBtns = document.querySelectorAll('.popular-player');
            
            // Player search with autocomplete
            playerSearch.addEventListener('input', handlePlayerSearch);
            playerSearch.addEventListener('blur', () => {
                setTimeout(() => hideAutocomplete(), 150);
            });
            
            // Generate card button
            generateBtn.addEventListener('click', generatePlayerCard);
            
            // Popular player buttons
            popularBtns.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const playerName = e.target.dataset.player;
                    document.getElementById('playerSearch').value = playerName;
                    generatePlayerCard();
                });
            });
            
            // Enter key to generate card
            playerSearch.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    hideAutocomplete();
                    generatePlayerCard();
                }
            });
        }
        
        function handlePlayerSearch(e) {
            const query = e.target.value.trim();
            
            if (query.length < 2) {
                hideAutocomplete();
                return;
            }
            
            // Debounce the search
            clearTimeout(autocompleteTimeout);
            autocompleteTimeout = setTimeout(() => {
                showAutocompleteSuggestions(query);
            }, 200);
        }
        
        function showAutocompleteSuggestions(query) {
            // Filter mock players
            const suggestions = mockPlayers.filter(player => 
                player.toLowerCase().includes(query.toLowerCase())
            ).slice(0, 5);
            
            const resultsDiv = document.getElementById('autocompleteResults');
            
            if (suggestions.length === 0) {
                hideAutocomplete();
                return;
            }
            
            resultsDiv.innerHTML = suggestions.map(suggestion => `
                <div class="autocomplete-item px-4 py-2 border-b border-gray-100 last:border-b-0" onclick="selectPlayer('${suggestion}')">
                    ${suggestion}
                </div>
            `).join('');
            
            resultsDiv.classList.remove('hidden');
        }
        
        function selectPlayer(playerName) {
            document.getElementById('playerSearch').value = playerName;
            hideAutocomplete();
        }
        
        function hideAutocomplete() {
            document.getElementById('autocompleteResults').classList.add('hidden');
        }
        
        function generatePlayerCard() {
            const playerName = document.getElementById('playerSearch').value.trim();
            const persona = document.getElementById('personaSelect').value;
            
            if (!playerName) {
                alert('Please enter a player name');
                return;
            }
            
            showLoading(true);
            
            // Simulate API call with timeout
            setTimeout(() => {
                const cardData = generateMockCardData(playerName, persona);
                displayPlayerCard(cardData, persona);
                showLoading(false);
            }, 1500); // 1.5 second delay to simulate API call
        }
        
        function generateMockCardData(playerName, persona) {
            // Generate consistent mock data based on player name
            const seed = hashString(playerName);
            const random = seedRandom(seed);
            
            const battingAvg = 25 + random() * 30; // 25-55
            const strikeRate = 110 + random() * 50; // 110-160
            const formRating = 5 + random() * 4.5; // 5-9.5
            
            const formDescriptions = ["Poor Form", "Average Form", "Good Form", "Hot Form", "Exceptional Form"];
            const formIndex = Math.min(Math.floor(formRating / 2), formDescriptions.length - 1);
            
            // Generate recent matches
            const teams = ['MI', 'CSK', 'SRH', 'KKR', 'RR', 'DC', 'RCB', 'PBKS', 'GT', 'LSG'];
            const recentMatches = [];
            for (let i = 0; i < 5; i++) {
                const score = 15 + Math.floor(random() * 80);
                const isNotOut = i === 0 && random() > 0.7;
                const opponent = teams[Math.floor(random() * teams.length)];
                const daysAgo = i * 4 + 3;
                
                recentMatches.push({
                    score: `${score}${isNotOut ? '*' : ''}`,
                    opponent: opponent,
                    daysAgo: daysAgo,
                    performance: score > 60 ? 'excellent' : score > 35 ? 'good' : 'average'
                });
            }
            
            // Generate live data
            const ballOutcomes = ['1', '2', '4', '6', '0', 'W', '.'];
            const last6Balls = [];
            for (let i = 0; i < 6; i++) {
                last6Balls.push(ballOutcomes[Math.floor(random() * ballOutcomes.length)]);
            }
            
            // Betting intelligence
            const marketOdds = 1.4 + random() * 1.1; // 1.4-2.5
            const modelOdds = 1.3 + random() * 1.0; // 1.3-2.3
            const expectedValue = ((1/modelOdds * marketOdds) - 1) * 100;
            
            return {
                playerName: playerName,
                battingAvg: Math.round(battingAvg * 10) / 10,
                strikeRate: Math.round(strikeRate * 10) / 10,
                recentForm: formDescriptions[formIndex],
                formRating: Math.round(formRating * 10) / 10,
                powerplaySR: Math.round((110 + random() * 40) * 10) / 10,
                deathOversSR: Math.round((130 + random() * 50) * 10) / 10,
                vsPaceAvg: Math.round((28 + random() * 17) * 10) / 10,
                vsSpinAvg: Math.round((25 + random() * 17) * 10) / 10,
                pressureRating: Math.round((5 + random() * 4.5) * 10) / 10,
                recentMatches: recentMatches,
                currentMatchStatus: random() > 0.7 ? 'Batting' : 'Not Playing',
                last6Balls: last6Balls,
                bettingOdds: {
                    marketOdds: Math.round(marketOdds * 100) / 100,
                    modelOdds: Math.round(modelOdds * 100) / 100,
                    expectedValue: Math.round(expectedValue * 10) / 10
                },
                valueOpportunities: Math.abs(expectedValue) > 5 ? [{
                    market: 'Runs Over 30.5',
                    expectedValue: Math.round(expectedValue * 10) / 10,
                    confidence: 65 + Math.floor(random() * 25)
                }] : [],
                profileImageUrl: `https://robohash.org/${encodeURIComponent(playerName)}?set=set1&size=150x150&bgset=bg1`,
                lastUpdated: new Date().toISOString(),
                dataSources: ['Mock', 'Consistent_Seed']
            };
        }
        
        function displayPlayerCard(cardData, persona) {
            const container = document.getElementById('cardsContainer');
            
            const cardHtml = `
                <div class="player-card bg-white rounded-lg shadow-lg overflow-hidden border-l-4 ${getPersonaBorderColor(persona)}">
                    <!-- Card Header -->
                    <div class="bg-gradient-to-r from-gray-800 to-gray-900 text-white p-4">
                        <div class="flex items-center space-x-4">
                            <img src="${cardData.profileImageUrl}" 
                                 alt="${cardData.playerName}"
                                 class="w-16 h-16 rounded-full border-2 border-white object-cover">
                            <div>
                                <h3 class="text-xl font-bold">${cardData.playerName}</h3>
                                <p class="text-gray-300 text-sm">${getPersonaLabel(persona)} Analysis</p>
                                <div class="flex items-center mt-1">
                                    <span class="text-xs bg-white bg-opacity-20 px-2 py-1 rounded">
                                        ✅ Generated
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Performance Stats -->
                    <div class="p-4 border-b">
                        <h4 class="font-semibold text-gray-800 mb-2">📊 Performance</h4>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <p class="text-gray-600">Batting Average</p>
                                <p class="font-bold text-lg">${cardData.battingAvg}</p>
                            </div>
                            <div>
                                <p class="text-gray-600">Strike Rate</p>
                                <p class="font-bold text-lg">${cardData.strikeRate}</p>
                            </div>
                        </div>
                        <div class="mt-3">
                            <p class="text-gray-600 text-sm">Recent Form</p>
                            <p class="font-semibold ${getFormColor(cardData.formRating)}">${cardData.recentForm} (${cardData.formRating}/10)</p>
                        </div>
                    </div>
                    
                    <!-- Situational Stats -->
                    <div class="p-4 border-b">
                        <h4 class="font-semibold text-gray-800 mb-2">🏏 Situational</h4>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Powerplay SR:</span>
                                <span class="font-medium">${cardData.powerplaySR}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Death Overs SR:</span>
                                <span class="font-medium">${cardData.deathOversSR}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">vs Pace Avg:</span>
                                <span class="font-medium">${cardData.vsPaceAvg}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Pressure Rating:</span>
                                <span class="font-medium">${cardData.pressureRating}/10</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Live Data -->
                    ${cardData.currentMatchStatus === 'Batting' ? `
                    <div class="p-4 border-b bg-green-50">
                        <h4 class="font-semibold text-gray-800 mb-2">🔴 Live</h4>
                        <p class="text-sm text-gray-600">Status: <span class="font-medium">${cardData.currentMatchStatus}</span></p>
                        <div class="mt-2">
                            <p class="text-xs text-gray-600 mb-1">Last 6 balls:</p>
                            <div class="flex space-x-1">
                                ${cardData.last6Balls.map(ball => `
                                    <span class="w-6 h-6 text-xs flex items-center justify-center rounded ${getBallColor(ball)}">${ball}</span>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                    ` : ''}
                    
                    <!-- Betting Intelligence (for betting persona) -->
                    ${persona === 'betting' && cardData.valueOpportunities.length > 0 ? `
                    <div class="p-4 bg-orange-50">
                        <h4 class="font-semibold text-gray-800 mb-2">🎰 Betting Intelligence</h4>
                        ${cardData.valueOpportunities.map(opp => `
                            <div class="text-sm">
                                <p class="font-medium">${opp.market}</p>
                                <p class="text-gray-600">EV: <span class="font-bold ${opp.expectedValue > 0 ? 'text-green-600' : 'text-red-600'}">${opp.expectedValue > 0 ? '+' : ''}${opp.expectedValue}%</span></p>
                                <p class="text-gray-600">Confidence: ${opp.confidence}%</p>
                            </div>
                        `).join('')}
                    </div>
                    ` : ''}
                    
                    <!-- Recent Games -->
                    <div class="p-4">
                        <h4 class="font-semibold text-gray-800 mb-2">📈 Last 5 Games</h4>
                        <div class="space-y-1">
                            ${cardData.recentMatches.map(match => `
                                <div class="flex items-center justify-between text-xs">
                                    <span class="px-2 py-1 ${getScoreColor(match.performance)} rounded font-medium">${match.score}</span>
                                    <span class="text-gray-500">vs ${match.opponent} • ${match.daysAgo} days ago</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <!-- Card Footer -->
                    <div class="p-3 bg-gray-50 text-xs text-gray-500">
                        <div class="flex justify-between">
                            <span>Updated: ${new Date(cardData.lastUpdated).toLocaleTimeString()}</span>
                            <span>Sources: ${cardData.dataSources.join(', ')}</span>
                        </div>
                    </div>
                </div>
            `;
            
            // Add to the beginning of the container
            container.insertAdjacentHTML('afterbegin', cardHtml);
        }
        
        // Helper functions
        function getPersonaLabel(persona) {
            const labels = {
                'betting': '🎰 Betting SME',
                'commentary': '📺 TV Pundit',
                'coaching': '🎯 Coaching Staff',
                'fantasy': '⚡ Fantasy Team'
            };
            return labels[persona] || persona;
        }
        
        function getPersonaBorderColor(persona) {
            const colors = {
                'betting': 'border-orange-500',
                'commentary': 'border-blue-500',
                'coaching': 'border-green-500',
                'fantasy': 'border-red-500'
            };
            return colors[persona] || 'border-gray-500';
        }
        
        function getFormColor(rating) {
            if (rating >= 8) return 'text-green-600';
            if (rating >= 6) return 'text-yellow-600';
            return 'text-red-600';
        }
        
        function getBallColor(ball) {
            switch(ball) {
                case '4': return 'bg-blue-500 text-white';
                case '6': return 'bg-green-500 text-white';
                case 'W': return 'bg-red-500 text-white';
                case '0': case '.': return 'bg-gray-300 text-gray-700';
                default: return 'bg-yellow-200 text-yellow-800';
            }
        }
        
        function getScoreColor(performance) {
            switch(performance) {
                case 'excellent': return 'bg-green-100 text-green-800';
                case 'good': return 'bg-blue-100 text-blue-800';
                default: return 'bg-yellow-100 text-yellow-800';
            }
        }
        
        function showLoading(show) {
            const indicator = document.getElementById('loadingIndicator');
            if (show) {
                indicator.classList.remove('hidden');
            } else {
                indicator.classList.add('hidden');
            }
        }
        
        // Utility functions for consistent random data
        function hashString(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // Convert to 32bit integer
            }
            return Math.abs(hash);
        }
        
        function seedRandom(seed) {
            let x = Math.sin(seed) * 10000;
            return function() {
                x = Math.sin(x) * 10000;
                return x - Math.floor(x);
            };
        }
    </script>
</body>
</html>
