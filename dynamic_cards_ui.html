<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Player Cards Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .player-card {
            transition: all 0.3s ease;
        }
        .player-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .autocomplete-item {
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .autocomplete-item:hover {
            background-color: #f3f4f6;
        }
        
        .persona-betting { border-left: 4px solid #f59e0b; }
        .persona-commentary { border-left: 4px solid #3b82f6; }
        .persona-coaching { border-left: 4px solid #10b981; }
        .persona-fantasy { border-left: 4px solid #ef4444; }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-center mb-8">üé¥ Dynamic Player Cards System</h1>
        
        <!-- Search and Controls -->
        <div class="bg-white p-6 rounded-lg shadow-lg mb-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <!-- Player Search -->
                <div class="relative">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Search Player</label>
                    <input type="text" id="playerSearch" 
                           placeholder="Type player name..." 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           autocomplete="off">
                    <div id="autocompleteResults" class="absolute z-10 w-full bg-white border border-gray-300 rounded-lg mt-1 hidden max-h-60 overflow-y-auto"></div>
                </div>
                
                <!-- Persona Selection -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Persona</label>
                    <select id="personaSelect" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        <option value="betting">üé∞ Betting SME</option>
                        <option value="commentary">üì∫ TV Pundit</option>
                        <option value="coaching">üéØ Coaching Staff</option>
                        <option value="fantasy">‚ö° Fantasy Team</option>
                    </select>
                </div>
                
                <!-- Generate Button -->
                <div class="flex items-end">
                    <button id="generateCard" 
                            class="w-full px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium">
                        üé¥ Generate Card
                    </button>
                </div>
            </div>
            
            <!-- Popular Players Quick Access -->
            <div class="mt-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Popular Players</label>
                <div id="popularPlayers" class="flex flex-wrap gap-2">
                    <!-- Will be populated dynamically -->
                </div>
            </div>
        </div>
        
        <!-- Generated Cards Display -->
        <div id="cardsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Cards will be inserted here -->
        </div>
        
        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white p-6 rounded-lg">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div>
                <p class="mt-2 text-gray-600">Generating dynamic card...</p>
            </div>
        </div>
    </div>

    <script>
        // Mock data - no API required
        const mockPlayers = [
            'Virat Kohli', 'MS Dhoni', 'Rohit Sharma', 'KL Rahul', 'Hardik Pandya',
            'A Kohli', 'Nikhil Kohli', 'Parth Kohli', 'Virandeep Singh', 'Virat Singh',
            'Virendra Kumar', 'Virk Ali', 'Suryakumar Yadav', 'Rishabh Pant', 
            'Jasprit Bumrah', 'AB de Villiers', 'David Warner', 'Steve Smith'
        ];
        
        let currentPlayerName = '';
        let autocompleteTimeout = null;
        
        // Initialize the system
        document.addEventListener('DOMContentLoaded', function() {
            initializeSystem();
            setupEventListeners();
        });
        
        async function initializeSystem() {
            try {
                // Load popular players (no API call needed)
                loadPopularPlayers();
                console.log('üéØ Dynamic Cards System initialized with mock data');
                
            } catch (error) {
                console.error('Error initializing system:', error);
            }
        }
        
        function setupEventListeners() {
            const playerSearch = document.getElementById('playerSearch');
            const generateBtn = document.getElementById('generateCard');
            
            // Player search with autocomplete
            playerSearch.addEventListener('input', handlePlayerSearch);
            playerSearch.addEventListener('blur', () => {
                setTimeout(() => hideAutocomplete(), 150);
            });
            
            // Generate card button
            generateBtn.addEventListener('click', generatePlayerCard);
            
            // Enter key to generate card
            playerSearch.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    generatePlayerCard();
                }
            });
        }
        
        function handlePlayerSearch(e) {
            const query = e.target.value.trim();
            
            if (query.length < 2) {
                hideAutocomplete();
                return;
            }
            
            // Debounce the search
            clearTimeout(autocompleteTimeout);
            autocompleteTimeout = setTimeout(() => {
                getAutocompleteSuggestions(query);
            }, 300);
        }
        
        async function getAutocompleteSuggestions(partial) {
            try {
                // Use mock data instead of API
                const suggestions = mockPlayers.filter(player => 
                    player.toLowerCase().includes(partial.toLowerCase())
                ).slice(0, 5);
                
                displayAutocompleteSuggestions(suggestions);
            } catch (error) {
                console.error('Error getting autocomplete suggestions:', error);
            }
        }
        
        function displayAutocompleteSuggestions(suggestions) {
            const resultsDiv = document.getElementById('autocompleteResults');
            
            if (suggestions.length === 0) {
                hideAutocomplete();
                return;
            }
            
            resultsDiv.innerHTML = suggestions.map(suggestion => `
                <div class="autocomplete-item px-4 py-2" onclick="selectPlayer('${suggestion}')">
                    ${suggestion}
                </div>
            `).join('');
            
            resultsDiv.classList.remove('hidden');
        }
        
        function selectPlayer(playerName) {
            document.getElementById('playerSearch').value = playerName;
            currentPlayerName = playerName;
            hideAutocomplete();
        }
        
        function hideAutocomplete() {
            document.getElementById('autocompleteResults').classList.add('hidden');
        }
        
        function loadPopularPlayers() {
            try {
                // Use mock popular players
                const popularPlayers = [
                    { name: 'Virat Kohli', identifier: 'virat_kohli' },
                    { name: 'MS Dhoni', identifier: 'ms_dhoni' },
                    { name: 'Rohit Sharma', identifier: 'rohit_sharma' },
                    { name: 'KL Rahul', identifier: 'kl_rahul' },
                    { name: 'Hardik Pandya', identifier: 'hardik_pandya' }
                ];
                
                displayPopularPlayers(popularPlayers);
            } catch (error) {
                console.error('Error loading popular players:', error);
            }
        }
        
        function displayPopularPlayers(players) {
            const container = document.getElementById('popularPlayers');
            
            container.innerHTML = players.map(player => `
                <button class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm hover:bg-gray-200 transition-colors"
                        onclick="selectPlayer('${player.name}')">
                    ${player.name}
                </button>
            `).join('');
        }
        
        function generatePlayerCard() {
            const playerName = document.getElementById('playerSearch').value.trim() || currentPlayerName;
            const persona = document.getElementById('personaSelect').value;
            
            if (!playerName) {
                alert('Please enter a player name');
                return;
            }
            
            showLoading(true);
            
            // Simulate API call with setTimeout
            setTimeout(() => {
                try {
                    const cardData = generateMockCardData(playerName, persona);
                    displayPlayerCard(cardData, persona);
                } catch (error) {
                    console.error('Error generating card:', error);
                    alert('Error generating card: ' + error.message);
                } finally {
                    showLoading(false);
                }
            }, 1500); // 1.5 second delay to simulate API
        }
        
        function displayPlayerCard(cardData, persona) {
            const container = document.getElementById('cardsContainer');
            
            const cardHtml = `
                <div class="player-card bg-white rounded-lg shadow-lg overflow-hidden persona-${persona}">
                    <!-- Card Header -->
                    <div class="bg-gradient-to-r from-gray-800 to-gray-900 text-white p-4">
                        <div class="flex items-center space-x-4">
                            <img src="${cardData.profile_image_url}" 
                                 alt="${cardData.player_name}"
                                 class="w-16 h-16 rounded-full border-2 border-white object-cover"
                                 onerror="this.src='https://via.placeholder.com/64x64?text=${cardData.player_name.replace(' ', '+')}&bg=1f2937&color=ffffff'">
                            <div>
                                <h3 class="text-xl font-bold">${cardData.player_name}</h3>
                                <p class="text-gray-300 text-sm">${getPersonaLabel(persona)} Analysis</p>
                                <div class="flex items-center mt-1">
                                    <span class="text-xs bg-white bg-opacity-20 px-2 py-1 rounded">
                                        ${cardData.profile_image_cached ? 'üì∑ Cached' : 'üîç Fresh'}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Performance Stats -->
                    <div class="p-4 border-b">
                        <h4 class="font-semibold text-gray-800 mb-2">üìä Performance</h4>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <p class="text-gray-600">Batting Average</p>
                                <p class="font-bold text-lg">${cardData.batting_avg}</p>
                            </div>
                            <div>
                                <p class="text-gray-600">Strike Rate</p>
                                <p class="font-bold text-lg">${cardData.strike_rate}</p>
                            </div>
                        </div>
                        <div class="mt-3">
                            <p class="text-gray-600 text-sm">Recent Form</p>
                            <p class="font-semibold ${getFormColor(cardData.form_rating)}">${cardData.recent_form} (${cardData.form_rating}/10)</p>
                        </div>
                    </div>
                    
                    <!-- Situational Stats -->
                    <div class="p-4 border-b">
                        <h4 class="font-semibold text-gray-800 mb-2">üèè Situational</h4>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Powerplay SR:</span>
                                <span class="font-medium">${cardData.powerplay_sr}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Death Overs SR:</span>
                                <span class="font-medium">${cardData.death_overs_sr}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">vs Pace Avg:</span>
                                <span class="font-medium">${cardData.vs_pace_avg}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Pressure Rating:</span>
                                <span class="font-medium">${cardData.pressure_rating}/10</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Live Data -->
                    ${cardData.current_match_status !== 'Not Playing' ? `
                    <div class="p-4 border-b bg-green-50">
                        <h4 class="font-semibold text-gray-800 mb-2">üî¥ Live</h4>
                        <p class="text-sm text-gray-600">Status: <span class="font-medium">${cardData.current_match_status}</span></p>
                        ${cardData.last_6_balls.length > 0 ? `
                        <div class="mt-2">
                            <p class="text-xs text-gray-600 mb-1">Last 6 balls:</p>
                            <div class="flex space-x-1">
                                ${cardData.last_6_balls.map(ball => `
                                    <span class="w-6 h-6 text-xs flex items-center justify-center rounded ${getBallColor(ball)}">${ball}</span>
                                `).join('')}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                    ` : ''}
                    
                    <!-- Betting Intelligence (for betting persona) -->
                    ${persona === 'betting' && cardData.value_opportunities.length > 0 ? `
                    <div class="p-4 bg-orange-50">
                        <h4 class="font-semibold text-gray-800 mb-2">üé∞ Betting Intelligence</h4>
                        ${cardData.value_opportunities.map(opp => `
                            <div class="text-sm">
                                <p class="font-medium">${opp.market}</p>
                                <p class="text-gray-600">EV: <span class="font-bold ${opp.expected_value > 0 ? 'text-green-600' : 'text-red-600'}">${opp.expected_value > 0 ? '+' : ''}${opp.expected_value}%</span></p>
                                <p class="text-gray-600">Confidence: ${opp.confidence}%</p>
                            </div>
                        `).join('')}
                    </div>
                    ` : ''}
                    
                    <!-- Card Footer -->
                    <div class="p-3 bg-gray-50 text-xs text-gray-500">
                        <div class="flex justify-between">
                            <span>Updated: ${new Date(cardData.last_updated).toLocaleTimeString()}</span>
                            <span>Sources: ${cardData.data_sources.join(', ')}</span>
                        </div>
                    </div>
                </div>
            `;
            
            // Add to the beginning of the container
            container.insertAdjacentHTML('afterbegin', cardHtml);
        }
        
        function getPersonaLabel(persona) {
            const labels = {
                'betting': 'üé∞ Betting SME',
                'commentary': 'üì∫ TV Pundit',
                'coaching': 'üéØ Coaching Staff',
                'fantasy': '‚ö° Fantasy Team'
            };
            return labels[persona] || persona;
        }
        
        function getFormColor(rating) {
            if (rating >= 8) return 'text-green-600';
            if (rating >= 6) return 'text-yellow-600';
            return 'text-red-600';
        }
        
        function getBallColor(ball) {
            switch(ball) {
                case '4': return 'bg-blue-500 text-white';
                case '6': return 'bg-green-500 text-white';
                case 'W': return 'bg-red-500 text-white';
                case '0': case '.': return 'bg-gray-300 text-gray-700';
                default: return 'bg-yellow-200 text-yellow-800';
            }
        }
        
        function generateMockCardData(playerName, persona) {
            // Generate consistent mock data based on player name
            const seed = hashString(playerName);
            const random = seedRandom(seed);
            
            const battingAvg = 25 + random() * 30; // 25-55
            const strikeRate = 110 + random() * 50; // 110-160
            const formRating = 5 + random() * 4.5; // 5-9.5
            
            const formDescriptions = ["Poor Form", "Average Form", "Good Form", "Hot Form", "Exceptional Form"];
            const formIndex = Math.min(Math.floor(formRating / 2), formDescriptions.length - 1);
            
            // Generate recent matches
            const teams = ['MI', 'CSK', 'SRH', 'KKR', 'RR', 'DC', 'RCB', 'PBKS', 'GT', 'LSG'];
            const recentMatches = [];
            for (let i = 0; i < 5; i++) {
                const score = 15 + Math.floor(random() * 80);
                const isNotOut = i === 0 && random() > 0.7;
                const opponent = teams[Math.floor(random() * teams.length)];
                const daysAgo = i * 4 + 3;
                
                recentMatches.push({
                    score: `${score}${isNotOut ? '*' : ''}`,
                    opponent: opponent,
                    daysAgo: daysAgo,
                    performance: score > 60 ? 'excellent' : score > 35 ? 'good' : 'average'
                });
            }
            
            // Generate live data
            const ballOutcomes = ['1', '2', '4', '6', '0', 'W', '.'];
            const last6Balls = [];
            for (let i = 0; i < 6; i++) {
                last6Balls.push(ballOutcomes[Math.floor(random() * ballOutcomes.length)]);
            }
            
            // Betting intelligence
            const marketOdds = 1.4 + random() * 1.1; // 1.4-2.5
            const modelOdds = 1.3 + random() * 1.0; // 1.3-2.3
            const expectedValue = ((1/modelOdds * marketOdds) - 1) * 100;
            
            return {
                player_name: playerName,
                batting_avg: Math.round(battingAvg * 10) / 10,
                strike_rate: Math.round(strikeRate * 10) / 10,
                recent_form: formDescriptions[formIndex],
                form_rating: Math.round(formRating * 10) / 10,
                powerplay_sr: Math.round((110 + random() * 40) * 10) / 10,
                death_overs_sr: Math.round((130 + random() * 50) * 10) / 10,
                vs_pace_avg: Math.round((28 + random() * 17) * 10) / 10,
                vs_spin_avg: Math.round((25 + random() * 17) * 10) / 10,
                pressure_rating: Math.round((5 + random() * 4.5) * 10) / 10,
                last_5_games: recentMatches,
                current_match_status: random() > 0.7 ? 'Batting' : 'Not Playing',
                last_6_balls: last6Balls,
                betting_odds: {
                    market_odds: Math.round(marketOdds * 100) / 100,
                    model_odds: Math.round(modelOdds * 100) / 100,
                    expected_value: Math.round(expectedValue * 10) / 10
                },
                value_opportunities: Math.abs(expectedValue) > 5 ? [{
                    market: 'Runs Over 30.5',
                    market_odds: Math.round(marketOdds * 100) / 100,
                    model_odds: Math.round(modelOdds * 100) / 100,
                    expected_value: Math.round(expectedValue * 10) / 10,
                    confidence: 65 + Math.floor(random() * 25)
                }] : [],
                profile_image_url: `https://robohash.org/${encodeURIComponent(playerName)}?set=set1&size=150x150&bgset=bg1`,
                profile_image_cached: false,
                last_updated: new Date().toISOString(),
                data_sources: ['Mock', 'Consistent_Seed']
            };
        }
        
        // Utility functions for consistent random data
        function hashString(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // Convert to 32bit integer
            }
            return Math.abs(hash);
        }
        
        function seedRandom(seed) {
            let x = Math.sin(seed) * 10000;
            return function() {
                x = Math.sin(x) * 10000;
                return x - Math.floor(x);
            };
        }

        function showLoading(show) {
            const indicator = document.getElementById('loadingIndicator');
            if (show) {
                indicator.classList.remove('hidden');
            } else {
                indicator.classList.add('hidden');
            }
        }
    </script>
</body>
</html>
